# k8s常见面试题目

## 什么是k8s？

Kubernetes（通常简称为K8s）是一个开源的容器编排和管理平台，旨在自动化应用程序的部署、扩展和运维。主要特性和功能包括：

- 自动化容器部署：根据配置自动化管理和部署应用程序

- 自动化负载均衡和服务发现： Kubernetes提供了负载均衡器和DNS服务，自动处理流量路由和服务发现

- 自动扩展：根据应用程序的负载和需求自动扩展

- 自动修复：如果节点或者容器发生故障，能够自动恢复和重新部署应用程序

- 容器编排：定义和管理多个容器组成的应用程序

## k8s和docker的关系

- Docker是一种开源的容器化平台，允许开发者将应用程序及其依赖项打包成一个容器。容器是一种轻量级、可移植、自包含的运行环境，其中包含应用程序的代码、运行时、系统工具、系统库等。

- Kubernetes 是一个开源的容器编排和管理平台，用于自动化容器化应用程序的部署、伸缩和操作。Kubernetes 则构建在 Docker（以及其他容器运行时）之上，为容器提供了编排、管理和服务发现的功能。

- Docker 是一种容器技术，而 Kubernetes 是一个用于管理和编排容器的平台。

## k8s的优势、特点和使用场景

优势：

- 自动化容器部署

- 自动化负载均衡和服务发现

- 自动扩展

- 自动修复

- 容器编排

使用场景：

- 微服务架构： Kubernetes 是构建和管理微服务架构的理想选择。它能够有效地处理大量微服务的部署和调度。

- 容器化应用程序： Kubernetes 最初设计用于容器编排，因此特别适用于运行和管理容器化应用程序。

- 分布式系统： 适用于需要高可用性、可伸缩性和自动化管理的分布式系统。


## k8s的缺点

- 复杂性：配置过于复杂

- 资源消耗：k8s本身需要一定的计算和存储资源来运行

- 不适用于所有应用：对于一些简单应用显得非常臃肿繁琐


## k8s组件有哪些，作用分别是？

- 控制平面组件

    - etcd：etcd是一个分布式的键值对存储数据库，主要是用于持久化存储k8s中创建的pod，service，RS等资源

    - Api-server：

        - API-server作为中心组件，将k8s集群状态存储到etcd中，

        - 以restful-api的形式提供查询crud接口给其他组件，并提供认证、授权、准入、验证资源等服务。

    - 控制器管理器：通过API-server监听资源变更，并对变更执行相应的操作。

    - 调度器：根据调度算法选择节点，给pod分配节点

- 工作节点组件

    - kubelet：Kubelet负责所有运行在工作节点上内容

        - 创建node资源向Api-server注册该节点

        - 持续监控API服务器是否把该节点分配给pod，然后启动pod容器

        - Kubelet随后持续监控运行的容器，向API服务器报告它们的状态、事件和资源消耗。

        - 运行容器存活探针

    - kube-proxy：主要作用是实现 Kubernetes 集群内部的服务发现和负载均衡

    - 容器运行时：从特定容器镜像运行容器。

- 附加组件

    - dns服务器

    - ingress服务器


## k8s是如何实现集群管理的？

## kubectl的作用是？

## 命名空间的作用是什么？

- k8s的命名空间为资源名称提供了一个作用域。要求资源名称在一个命名空间中保持唯一。

- 将复杂的系统资源分配到不同的命名空间中，便于管理

- 支持多租户环境，实现资源隔离

## 什么是pod?

Pod（容器组）是 Kubernetes 中最小的调度单元，用于运行容器化应用程序。Pod 可以包含一个或多个紧密关联的容器，它们共享相同的网络命名空间、存储卷和其他资源。pod的特点包括：

- 单一调度单元，也是扩容和缩容的基本单位

- 共享网络命名空间

- 共享存储卷

- 共享声明周期

## pod的重启策略有哪些？

restartPolicy的值有三个：

- Always： 这是默认的重启策略。如果容器失败或退出，Kubernetes会尝试无限次地重启它。

- onFaliure：在容器失败时才会重启。如果容器正常退出（状态码为0），则不会进行重启。

- Never：容器退出时不会重启，需要手动触发Pod的重新创建。

pod什么时候被判定为失败？

- 进程退出码非零

- 容器超出资源限制 

- Liveness Probe 失败

- OOM（Out of Memory）

## pod的镜像拉取策略？

- IfNotPresent

- Always

- Never

## kubenetes针对pod资源对象的健康监测机制?

- 存活探针

- 就绪探针

## 存活探针的属性参数有哪些？

- initialDelaySeconds：表示在容器启动后延时多久秒才开始探测

- periodSeconds：表示执行探测的频率，即间隔多少秒探测一次

- timeoutSeconds：表示探测超时时间

- successThreshold：表示最少连续探测成功多少次才被认定为成功

- failureThreshold：表示连续探测失败多少次才被认定为失败

## k8s创建一个pod的详细过程？

- 定义Pod的YAML文件，创建一个包含Pod配置的YAML文件

- 使用kubectl工具提交YAML文件

- Kubernetes API Server 接受请求，并将 Pod 的配置信息存储到 etcd（分布式键值存储）中

- Kubernetes Controller Manager 启动了一个叫做 Pod Controller 的控制器。该控制器监控 etcd 中的变更，并确保系统的当前状态与期望的状态一致

- Kubernetes Scheduler 接收到 Pod 的定义后，负责将 Pod 调度到集群中的某个节点

- 一旦 Scheduler 决定了将 Pod 调度到哪个节点，Kubelet 就会在该节点上创建 Pod 中定义的容器。Kubelet 会监控容器的运行状态，如果容器终止（例如，由于发生故障或达到重启策略的限制），Kubelet 会根据 Pod 的重启策略采取相应的操作，可能会重启容器。

- Kubernetes Controller Manager 中的 Pod Controller 感知到 Kubelet 的状态更新，确保系统的当前状态与期望的状态保持一致。如果有必要，它可能会触发其他操作，如启动更多的副本等。

## pod的声明周期？

Pod 在 Kubernetes 中有不同的声明周期阶段，它们包括：

- Pending（等待）：Pod 已经被创建，但尚未被调度到节点上运行。

- Running（运行中）：Pod 已经被调度到节点上并且容器正在运行。

- Succeeded（成功）：所有 Pod 中的容器都已成功运行，并且已经退出。

- Failed（失败）：Pod 中至少有一个容器以非零的退出代码终止。

- Unknown（未知）：由于某些原因，无法获取 Pod 的状态。

## pod一致处于pending状态一般有哪些情况，怎么排查？（重点，持续更新）

- 调度问题：节点资源不足

- 存储问题：如果 Pod 配置了存储卷，但没有正确挂载

- 镜像问题：如果容器镜像无法拉取

## pod的共享资源

- PID 命名空间：Pod 中的不同应用程序可以看到其他应用程序的进程 ID

- 网络命名空间：Pod 中的多个容器能够访问同一个IP和端口范围

- IPC 命名空间：

- UTS 命名空间：Pod 中的多个容器共享一个主机名；

- Volumes（共享存储卷）




